version: 2.1

# Define jobs for backend and frontend
jobs:
  back-job:
    docker:
      - image: cimg/node:18.0  # Node.js 버전, 백엔드 실행 환경에 맞게 변경
    working_directory: /home/kevin/snack/cicd_project/back
    steps:
      - checkout
      - run:
          name: "Install Backend Dependencies"
          command: npm install
      - run:
          name: "Run Backend Tests"
          command: npm test

  front-job:
    docker:
      - image: cimg/node:18.0  # Node.js 버전, 프론트엔드 실행 환경에 맞게 변경
    working_directory: /home/kevin/snack/cicd_project/front
    steps:
      - checkout
      - run:
          name: "Install Frontend Dependencies"
          command: npm install
      - run:
          name: "Run Frontend Tests"
          command: npm test

  manifest-job:
    docker:
      - image: cimg/base:current  # Kubernetes manifest 작업을 위한 기본 이미지
    working_directory: /home/kevin/snack/cicd_project/manifest
    steps:
      - checkout
      - run:
          name: "Validate Kubernetes Manifest"
          command: kubectl apply --dry-run=client -f .

# Define workflow to orchestrate jobs
workflows:
  version: 2
  build-and-test:
    jobs:
      - back-job
      - front-job
      - manifest-job:
          requires:
            - back-job
            - front-job

